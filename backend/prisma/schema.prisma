generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Skin {
  id               String         @id @db.VarChar(64)
  marketHashName   String         @db.VarChar(255)
  buffGoodsId      Int?
  iconUrl          String?
  priceHistory     PriceHistory[]
}

model PriceHistory {
  id        Int      @id @default(autoincrement())
  skinId    String   @db.VarChar(64)
  price     Decimal  @db.Decimal(18, 2)
  volume    Int?
  source    String   @db.VarChar(32)
  timestamp DateTime @default(now())

  skin Skin @relation(fields: [skinId], references: [id])

  @@index([skinId, source, timestamp])
}

model UnboxSession {
  id             Int       @id @default(autoincrement())
  hostAddress    String?
  status         String    @db.VarChar(32)
  totalPool      Decimal   @db.Decimal(18, 2) @default(0)
  result         String?   @db.VarChar(32)
  startTime      DateTime?
  endTime        DateTime?
  createdAt      DateTime  @default(now())
  bets           UnboxBet[]

  @@index([status, startTime])
}

model UnboxBet {
  id          Int          @id @default(autoincrement())
  sessionId   Int
  userAddress String       @db.VarChar(64)
  prediction  String       @db.VarChar(16)
  amount      Decimal      @db.Decimal(18, 2)
  payout      Decimal?     @db.Decimal(18, 2)
  createdAt   DateTime     @default(now())

  session UnboxSession @relation(fields: [sessionId], references: [id])

  @@index([sessionId, prediction])
  @@index([userAddress])
}

model UserStats {
  id           Int      @id @default(autoincrement())
  address      String   @unique @db.VarChar(64)
  totalBets    Int      @default(0)
  totalWins    Int      @default(0)
  totalWagered Decimal  @db.Decimal(18, 2) @default(0)
  totalProfit  Decimal  @db.Decimal(18, 2) @default(0)
  updatedAt    DateTime @updatedAt
}

model UserTransaction {
  id         Int      @id @default(autoincrement())
  address    String   @db.VarChar(64)
  module     String   @db.VarChar(32)
  type       String   @db.VarChar(32)
  amount     Decimal  @db.Decimal(18, 2)
  sessionId  Int?
  betId      Int?
  createdAt  DateTime @default(now())

  @@index([address, createdAt])
  @@index([module, type])
}
